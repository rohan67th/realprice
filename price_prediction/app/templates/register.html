{% extends 'base.html' %}
{% block title %} Register {% endblock %} 

{% block content %}
<div class="flex items-center justify-center min-h-screen px-4 sm:px-6 lg:px-8">
  <div
    class="bg-white/10 backdrop-blur-xl border border-white/20 shadow-2xl rounded-2xl p-8 w-full max-w-5xl"
  >
    <!-- Heading -->
    <div class="text-center mb-6">
      <h2 class="text-3xl font-bold text-black">Create Your Account</h2>
      <p class="text-gray-300 mt-1 text-sm">
        Join us to start predicting smarter
      </p>
    </div>

    {% if messages %}
    <div>
      {% for message in messages %}
      <div
        class="mb-4 px-4 py-3 rounded text-sm {% if message.tags == 'error' %}bg-red-100 text-red-700 border border-red-300 {% elif message.tags == 'success' %}bg-green-100 text-green-700 border border-green-300 {% else %}bg-blue-100 text-blue-700 border border-blue-300 {% endif %}"
      >
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Registration Form -->
    <form
      method="POST"
      enctype="multipart/form-data"
      action="{% url 'register' %}"
    >
      {% csrf_token %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Left Column -->
        <div class="space-y-4">
          <!-- Full Name -->
          <div class="relative">
            <i
              class="ri-user-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-300 text-lg"
            ></i>
            <input
              type="text"
              placeholder="Full Name"
              required
              name="username"
              class="pl-10 pr-4 py-3 w-full rounded-lg bg-white text-black placeholder-gray-500 border border-gray-400/30 focus:ring-2 focus:ring-primary focus:outline-none"
            />
          </div>

          <!-- Email -->
          <div class="relative">
            <i
              class="ri-mail-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-300 text-lg"
            ></i>
            <input
              type="email"
              placeholder="Email Address"
              required
              name="email"
              class="pl-10 pr-4 py-3 w-full rounded-lg bg-white text-black placeholder-gray-500 border border-gray-400/30 focus:ring-2 focus:ring-primary focus:outline-none"
            />
          </div>

          <!-- Phone -->
          <div class="relative">
            <i
              class="ri-phone-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-300 text-lg"
            ></i>
            <input
              type="text"
              placeholder="Phone Number"
              required
              name="phone"
              class="pl-10 pr-4 py-3 w-full rounded-lg bg-white text-black placeholder-gray-500 border border-gray-400/30 focus:ring-2 focus:ring-primary focus:outline-none"
            />
          </div>

          <!-- Gender -->
          <div class="relative">
            <i
              class="ri-user-smile-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-300 text-lg"
            ></i>
            <select
              name="gender"
              required
              class="pl-10 pr-4 py-3 w-full rounded-lg bg-white text-black placeholder-gray-500 border border-gray-400/30 focus:ring-2 focus:ring-primary focus:outline-none"
            >
              <option value="" disabled selected>Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>

        <!-- Right Column -->
        <div class="space-y-4">
          <!-- Address -->
          <div class="relative">
            <i
              class="ri-map-pin-line absolute left-3 top-5 text-gray-300 text-lg"
            ></i>
            <textarea
              placeholder="Address"
              required
              name="address"
              class="pl-10 pr-4 pt-3 pb-2 w-full rounded-lg bg-white text-black placeholder-gray-500 border border-gray-400/30 focus:ring-2 focus:ring-primary focus:outline-none resize-none h-24"
            ></textarea>
          </div>

          <!-- Profile Picture -->
          <div class="relative">
            <i
              class="ri-image-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-300 text-lg"
            ></i>
            <input
              type="file"
              name="profile_pic"
              accept="image/*"
              onchange="previewProfilePic(event)"
              class="pl-10 pr-4 py-2 w-full rounded-lg bg-white text-black border border-gray-400/30 focus:outline-none file:bg-primary file:text-white file:border-0 file:py-2 file:px-4 file:rounded-md file:mr-4 file:cursor-pointer"
            />
          </div>
          <img
            id="profile-pic-preview"
            src="#"
            alt="Preview"
            class="mt-2 w-24 h-24 object-cover rounded-full hidden border border-gray-300"
          />

          <!-- Proof of Identity -->
          <div class="relative">
            <i
              class="ri-file-text-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-300 text-lg"
            ></i>
            <input
              type="file"
              name="proof_of_identity"
              accept=".jpg,.jpeg,.png,.pdf"
              onchange="previewIdentityFile(event)"
              class="pl-10 pr-4 py-2 w-full rounded-lg bg-white text-black border border-gray-400/30 focus:outline-none file:bg-primary file:text-white file:border-0 file:py-2 file:px-4 file:rounded-md file:mr-4 file:cursor-pointer"
            />
          </div>
          <div
            id="identity-file-preview"
            class="mt-2 text-sm text-gray-700 hidden"
          ></div>

          <!-- Password -->
          <div class="relative">
            <i
              class="ri-lock-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-300 text-lg"
            ></i>
            <input
              type="password"
              placeholder="Password"
              required
              name="password"
              class="pl-10 pr-4 py-3 w-full rounded-lg bg-white text-black placeholder-gray-500 border border-gray-400/30 focus:ring-2 focus:ring-primary focus:outline-none"
            />
          </div>

          <!-- Confirm Password -->
          <div class="relative">
            <i
              class="ri-lock-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-300 text-lg"
            ></i>
            <input
              type="password"
              placeholder="Confirm Password"
              required
              name="confirm_password"
              class="pl-10 pr-4 py-3 w-full rounded-lg bg-white text-black placeholder-gray-500 border border-gray-400/30 focus:ring-2 focus:ring-primary focus:outline-none"
            />
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="mt-6">
        <button
          type="submit"
          class="w-full bg-gradient-to-r from-primary to-blue-600 text-white py-3 rounded-lg font-semibold hover:scale-105 hover:opacity-90 transition-all duration-300 flex items-center justify-center"
        >
          <span class="spinner hidden mr-2 animate-spin">⟳</span>
          <span class="btn-text">Create Account</span>
        </button>
      </div>

      <!-- Sign In Link -->
      <p class="mt-3 text-center text-gray-300 text-sm">
        Already have an account?
        <a
          href="{% url 'login' %}"
          class="text-primary hover:underline font-medium"
          >Sign In</a
        >
      </p>
    </form>

    <!-- Footer -->
    <p class="text-center text-white text-sm mt-4">
      © 2025 Price Prediction Platform. All rights reserved.
    </p>
  </div>
</div>

<script>
  function previewProfilePic(event) {
    const file = event.target.files[0];
    const preview = document.getElementById("profile-pic-preview");
    if (file && file.type.startsWith("image/")) {
      preview.src = URL.createObjectURL(file);
      preview.classList.remove("hidden");
    } else {
      preview.classList.add("hidden");
      preview.src = "#";
    }
  }

  function previewIdentityFile(event) {
    const file = event.target.files[0];
    const previewDiv = document.getElementById("identity-file-preview");
    if (!file) {
      previewDiv.classList.add("hidden");
      return;
    }
    previewDiv.innerHTML = "";

    if (file.type.startsWith("image/")) {
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      img.className =
        "w-24 h-24 object-cover rounded-md border border-gray-300";
      previewDiv.appendChild(img);
    } else if (file.type === "application/pdf") {
      const icon = document.createElement("div");
      icon.innerHTML = `<i class="ri-file-pdf-line text-red-500 text-2xl"></i> <span>${file.name}</span>`;
      icon.className = "flex items-center gap-2";
      previewDiv.appendChild(icon);
    } else {
      previewDiv.textContent = file.name;
    }

    previewDiv.classList.remove("hidden");
  }
</script>
{% endblock %}
